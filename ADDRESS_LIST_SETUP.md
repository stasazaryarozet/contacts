# СПИСОК АДРЕСАТОВ — ИНСТРУКЦИЯ

**Принципы**: q0 (Забота о Создателе), q1 (Можно ли без этого обойтись?)

---

## АРХИТЕКТУРА

```
ADDRESS_LIST.csv          ← Единый источник правды (вечный)
       ↓
manage_contacts.py        ← Автоматизация слияния и дедупликации
       ↓
ADDRESS_LIST_FOR_GSHEET.csv  ← Подготовленные данные
       ↓
tagging_ui.html           ← Локальный UI для тегирования (без облака)
       ↓
Экспорт обратно в CSV     ← Сохранение результатов
```

---

## ДЛЯ ОЛЬГИ: ТВОЯ ЗАДАЧА (ТВОРЧЕСКАЯ)

**Единственное, что нужно сделать:**

1. Открыть `tagging_ui.html` в браузере
2. Просмотреть список контактов
3. В колонке **"Тег"** выбрать категорию для каждого контакта:
   - **VIP** — ключевые персоны
   - **Коллега** — профессиональные контакты
   - **Студент** — студенты программ
   - **Прошлый тур** — участники предыдущих туров
   - **Партнёр** — партнёрские организации
4. Нажать **"Экспортировать CSV"** после завершения

**Всё остальное сделано автоматически. Никаких аккаунтов, никакого облака.**

---

## ДЛЯ РАЗРАБОТЧИКА: ТЕХНИЧЕСКАЯ РАБОТА

### 1. Подготовка данных

```bash
# Запуск скрипта управления контактами
cd /path/to/paris-2026
python3 tools/manage_contacts.py
```

**Что делает скрипт:**
- Загружает существующий `ADDRESS_LIST.csv`
- Импортирует новые контакты из:
  - `server/submissions.log` (форма на сайте)
  - Gmail экспорты (CSV)
  - iPhone контакты (VCF)
  - Прошлые туры
- Дедуплицирует по Email (Primary Key)
- Обновляет пустые поля из новых источников
- Сохраняет в `ADDRESS_LIST.csv`
- Экспортирует для Google Sheets: `ADDRESS_LIST_FOR_GSHEET.csv`

### 2. Создание UI для тегирования

```bash
# Запуск скрипта создания UI
python3 tools/create_tagging_ui.py
```

**Что делает скрипт:**
- Создаёт локальный HTML файл (`tagging_ui.html`)
- Загружает данные из CSV
- Применяет форматирование:
  - Таблица с контактами
  - Dropdown для тегов
  - Поля для заметок
  - Автосохранение прогресса
  - Статистика
- Открывает в браузере
- Готов к использованию офлайн

### 3. Импорт контактов из разных источников

#### Gmail экспорт

1. Gmail → Контакты → Экспорт → Google CSV
2. Сохранить как `gmail_contacts.csv`
3. Добавить в скрипт:

```python
manager.import_gmail_csv("gmail_contacts.csv", "Gmail")
```

#### iPhone контакты

1. iCloud → Контакты → Экспорт vCard
2. Сохранить как `iphone_contacts.vcf`
3. Добавить в скрипт:

```python
manager.import_vcf("iphone_contacts.vcf", "iPhone")
```

#### Прошлые туры

Если есть Excel/CSV с контактами прошлых туров:

```python
manager.import_gmail_csv("past_tours.csv", "Прошлый тур 2024")
```

### 4. После тегирования

Когда Ольга завершит тегирование в HTML UI:

```bash
# 1. В браузере нажать "Экспортировать CSV"
# 2. Файл скачается как ADDRESS_LIST_TAGGED.csv
# 3. Обновить основной файл:
cp ~/Downloads/ADDRESS_LIST_TAGGED.csv ADDRESS_LIST.csv
```

---

## СТРУКТУРА ДАННЫХ

### ADDRESS_LIST.csv (Single Source of Truth)

| Поле | Тип | Описание | Обязательно |
|------|-----|----------|-------------|
| Email | string | Primary Key | ✓ |
| Name | string | Имя контакта | |
| Phone | string | Телефон | |
| Source | string | Источник (через запятую) | |
| Tag | string | VIP/Коллега/Студент/Прошлый тур/Партнёр | |
| Notes | string | Заметки | |
| DateAdded | date | Дата добавления (YYYY-MM-DD) | |

### Дедупликация

**Primary Key**: Email (нормализован: lowercase, trim)

**Логика слияния при дубликатах:**
- Email уже есть → обновляются только пустые поля
- Source объединяются через запятую
- Tag и Notes не перезаписываются

---

## ЗАВИСИМОСТИ

**Нет зависимостей.** Только Python 3 (встроенный в macOS) и браузер.

---

## БЕЗОПАСНОСТЬ

**Credentials**:
- НЕ коммитить в git
- Хранить в переменных окружения
- Использовать `.env` файл (в `.gitignore`)

**CSV файлы**:
- `ADDRESS_LIST.csv` → приватный репозиторий или локально
- Не публиковать персональные данные
- GDPR compliance: хранение только с согласия

---

## FAQ

**Q: Можно ли тегировать в Excel/Numbers вместо HTML UI?**  
A: Да, просто открой `ADDRESS_LIST_FOR_GSHEET.csv` в любом редакторе и сохрани как CSV.

**Q: Как добавить новый тег?**  
A: Отредактировать `tools/create_tagging_ui.py`, секция с `<option>`, добавить новый вариант.

**Q: Что если появились дубликаты по имени, но разные email?**  
A: Это разные контакты. Primary Key — только Email.

**Q: Можно ли использовать телефон как Primary Key?**  
A: Нет. Форма на сайте принимает email ИЛИ телефон, но для консолидации используется только email. Контакты только с телефоном — отдельная задача.

---

## ПРИМЕРЫ

### Запуск полного цикла

```bash
# 1. Подготовка
cd "/Users/azaryarozet/Library/Mobile Documents/com~apple~CloudDocs/Projects/paris-2026"

# 2. Слияние контактов
python3 tools/manage_contacts.py

# 3. Создание UI для тегирования
python3 tools/create_tagging_ui.py

# 4. UI откроется в браузере автоматически
# Ольга может начинать тегирование
```

### Добавление нового источника

```python
# В tools/manage_contacts.py, функция main()

# Gmail
manager.import_gmail_csv("exports/gmail_2025.csv", "Gmail")

# iPhone
manager.import_vcf("exports/iphone_all.vcf", "iPhone")

# Excel from past tour
manager.import_gmail_csv("exports/paris_2024.csv", "Прошлый тур 2024")
```

---

## СТАТУС

✓ ADDRESS_LIST.csv создан  
✓ manage_contacts.py готов  
✓ setup_address_gsheet.py готов  
✓ Инструкция написана

**Следующий шаг**: Собрать экспорты контактов и запустить скрипты

---

**Создано**: 2025-10-29  
**Принципы**: OPERATIONAL_MODEL_PROPOSAL_v7.md (q0, q1)  
**Версия**: 1.0


